#!/usr/bin/env bash

# Your Projects Directory
# I like to keep my projects in ~/Projects
# -----------------------------------------------------------------------------
home_directory="$HOME/Projects"
bower_packages="$HOME/components"


# Initialise
function init {
  while true; do
    if [ "${2:-}" = "Bootstrap" ]; then
      prompt="1/2"
       default=1
    elif [ "${2:-}" = "Foundation" ]; then
      prompt="1/2"
      default=2
    else
      prompt="1:Bootstrap | 2:Foundation"
      default=
    fi
    # Ask the question
    read -p "$1 [$prompt] " REPLY
    # Default?
    if [ -z "$REPLY" ]; then
       REPLY=$default
    fi
    # Check if the reply is valid
    case "$REPLY" in
      1*|1*) return 0 ;;
      2*|2*) return 1 ;;
    esac
  done
}

# Check Bower Packages
function bower_install() {
  if [[ -d "$bower_packages/${@}" ]]; then
    echo "${@} is already installed"
  else
    bower install "${@}"
  fi
}

# Create project directory and assets
function create_project() {
  # Check if Project Directory Exists
  if [ -d "$home_directory/${@}" ]; then
    # Ask user to enter a different name or overwrite the directory
    read -p "â— the name you chose exists, overwrite matching files? [y/n] " respond

    # Overwrite existing directories and matching files
    if [ "$respond" = "y" ]; then
      echo ""
      echo "â—â—â—  Overwriting existing directory and matching files..."
      mkdir -p $home_directory/"${@}"/assets/{css,fonts,img,js}
    elif [ "$respond" = "n" ]; then
      echo "ðŸš«  no balls to do it huh? now aborting..."
      echo "" && exit
    fi 
  else
    echo "Created project directory: ${@}"  
    mkdir -p $home_directory/"${@}"/assets/{css,fonts,img,js}
  fi  
}

# =============================================================================
# Begin Installation Process
# =============================================================================


if init "Initialise Project using: "; then
# Bootstrap 
# =============================================================================
  
  # Check if Bootstrap Package is installed
  bower_install bootstrap

  # Create Project Directory
  read -p "Please enter directory name:" project_name
  create_project $project_name
  echo ""
  
  # Boostrap Components
  echo "Copying Bootstrap components"
  
  echo "  â””â”€â”€ Copying bootstrap/img > $home_directory/$project_name/assets/img"
  cp -R "$bower_packages/bootstrap/img" "$home_directory/$project_name/assets"
  
  echo "  â”œâ”€â”€ Copying bootstrap/js > $home_directory/$project_name/assets/js"
  cp -R "$bower_packages/bootstrap/js" "$home_directory/$project_name/assets"
  
  echo "  â””â”€â”€ Copying bootstrap/less > $home_directory/$project_name/assets/less"
  cp -R "$bower_packages/bootstrap/less" "$home_directory/$project_name/assets"
  
  # Compile Less to CSS
  echo ""
  echo "Compiling Less to CSS"
  cd "$home_directory/$project_name/assets/"

  function compile_less(){
    echo "  create .assets/${@}.min.css"
    lessc --yui-compress less/"${@}".less > css/"${@}".min.css
  }
  
  compile_less bootstrap
  compile_less responsive
  
  # Cleanup
  echo ""
  rm -rf "$home_directory/$project_name/assets/js/tests"
  rm -rf "$home_directory/$project_name/assets/less/tests"
   
  echo "âœ…  Done! Built Bootstrap project in $home_directory/$project_name"
  echo "" 
else
# Foundation
# =============================================================================

  # Check if Bootstrap Package is installed
  bower_install foundation

  # Create Project Directory
  read -p "Please enter directory name:" project_name
  create_project $project_name
  
  # Install Foundation using Sass
  cd "$home_directory/$project_name"
  echo ""
  echo "Adding config.rb to project"
  curl -O -# "https://gist.github.com/pongstr/5743895/raw/foundation.rb" && mv "foundation.rb" "config.rb"
  
  # Install Foundation Sass
  echo "Copying Foundation components"
  echo ""
    
  echo "  â”œâ”€â”€ Copying foundation/js > $home_directory/$project_name/assets"
  cp -R "$bower_packages/foundation/js" "$home_directory/$project_name/assets"
  
  echo "  â”œâ”€â”€ Copying foundation/scss > $home_directory/$project_name/scss"
  cp -R "$bower_packages/foundation/scss" "$home_directory/$project_name/"

  # Compile Sass to CSS
  echo ""
  echo "Compiling sass stylesheets to css"
  cd "$home_directory/$project_name" && compass compile .

  echo ""
  echo "âœ…  Done! Built Foundation project in $home_directory/$project_name"
  echo ""  
  
fi